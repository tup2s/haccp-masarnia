generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider  = "postgresql"
  url       = env("DATABASE_URL")
  directUrl = env("DIRECT_URL")
}

model CompanySettings {
  id          Int      @id @default(autoincrement())
  companyName String   @default("")
  address     String   @default("")
  nip         String   @default("")
  vetNumber   String   @default("")
  phone       String   @default("")
  email       String   @default("")
  ownerName   String   @default("")
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt
  printerIp   String   @default("")
  printerPort Int      @default(9100)
  labelWidth  Int      @default(60)
  labelHeight Int      @default(40)
}

model User {
  id                   Int                    @id @default(autoincrement())
  email                String                 @unique
  password             String
  name                 String
  role                 String                 @default("EMPLOYEE")
  createdAt            DateTime               @default(now())
  updatedAt            DateTime               @updatedAt
  auditRecords         AuditRecord[]
  cleaningRecords      CleaningRecord[]
  correctiveActions    CorrectiveAction[]
  curingBatches        CuringBatch[]
  documents            Document[]
  pestControlChecks    PestControlCheck[]
  productionBatches    ProductionBatch[]
  receptions           RawMaterialReception[]
  temperatureReadings  TemperatureReading[]
  trainingParticipants TrainingParticipant[]
}

model CCP {
  id                  Int                @id @default(autoincrement())
  name                String
  description         String
  hazardType          String
  criticalLimit       String
  monitoringMethod    String
  monitoringFrequency String
  correctiveAction    String
  verificationMethod  String
  recordKeeping       String
  isActive            Boolean            @default(true)
  createdAt           DateTime           @default(now())
  updatedAt           DateTime           @updatedAt
  temperaturePoints   TemperaturePoint[]
}

model Hazard {
  id                Int      @id @default(autoincrement())
  name              String
  type              String
  source            String
  preventiveMeasure String
  significance      String
  processStep       String
  createdAt         DateTime @default(now())
  updatedAt         DateTime @updatedAt
}

model TemperaturePoint {
  id        Int                  @id @default(autoincrement())
  name      String
  location  String
  type      String
  minTemp   Float
  maxTemp   Float
  ccpId     Int?
  isActive  Boolean              @default(true)
  createdAt DateTime             @default(now())
  updatedAt DateTime             @updatedAt
  ccp       CCP?                 @relation(fields: [ccpId], references: [id])
  readings  TemperatureReading[]
}

model TemperatureReading {
  id                 Int              @id @default(autoincrement())
  temperaturePointId Int
  temperature        Float
  isCompliant        Boolean
  notes              String?
  readAt             DateTime         @default(now())
  userId             Int
  createdAt          DateTime         @default(now())
  temperaturePoint   TemperaturePoint @relation(fields: [temperaturePointId], references: [id])
  user               User             @relation(fields: [userId], references: [id])
}

model Supplier {
  id               Int                    @id @default(autoincrement())
  name             String
  address          String
  phone            String?
  email            String?
  vetNumber        String?
  contactPerson    String?
  isApproved       Boolean                @default(true)
  notes            String?
  createdAt        DateTime               @default(now())
  updatedAt        DateTime               @updatedAt
  materials        Material[]
  materialReceipts MaterialReceipt[]
  rawMaterials     RawMaterial[]
  receptions       RawMaterialReception[]
}

model RawMaterial {
  id                Int                    @id @default(autoincrement())
  name              String
  category          String
  unit              String
  supplierId        Int?
  storageConditions String?
  shelfLife         Int?
  allergens         String?
  createdAt         DateTime               @default(now())
  updatedAt         DateTime               @updatedAt
  batchMaterials    BatchMaterial[]
  supplier          Supplier?              @relation(fields: [supplierId], references: [id])
  receptions        RawMaterialReception[]
}

model RawMaterialReception {
  id                 Int             @id @default(autoincrement())
  rawMaterialId      Int
  supplierId         Int
  batchNumber        String
  quantity           Float
  unit               String
  expiryDate         DateTime?
  temperature        Float?
  isCompliant        Boolean         @default(true)
  notes              String?
  documentNumber     String?
  receivedAt         DateTime        @default(now())
  receivedTime       String?
  vehicleClean       Boolean?        @default(true)
  vehicleTemperature Float?
  packagingIntact    Boolean?        @default(true)
  documentsComplete  Boolean?        @default(true)
  userId             Int
  createdAt          DateTime        @default(now())
  batchMaterials     BatchMaterial[]
  curingBatches      CuringBatch[]
  rawMaterial        RawMaterial     @relation(fields: [rawMaterialId], references: [id])
  supplier           Supplier        @relation(fields: [supplierId], references: [id])
  user               User            @relation(fields: [userId], references: [id])
}

model CuringBatch {
  id               Int                  @id @default(autoincrement())
  batchNumber      String
  receptionId      Int
  quantity         Float
  unit             String               @default("kg")
  curingMethod     String
  curingSaltAmount Float?
  brineWater       Float?
  brineSalt        Float?
  brineMaggi       Float?
  brineSugar       Float?
  startDate        DateTime             @default(now())
  plannedEndDate   DateTime
  actualEndDate    DateTime?
  temperature      Float?
  status           String               @default("IN_PROGRESS")
  notes            String?
  userId           Int
  createdAt        DateTime             @default(now())
  updatedAt        DateTime             @updatedAt
  meatDescription  String?
  productName      String?
  batchMaterials   BatchMaterial[]
  reception        RawMaterialReception @relation(fields: [receptionId], references: [id])
  user             User                 @relation(fields: [userId], references: [id])
}

model Product {
  id                  Int               @id @default(autoincrement())
  name                String
  category            String
  description         String?
  unit                String
  shelfLife           Int
  storageTemp         String
  allergens           String?
  requiredTemperature Float?            // Wymagana temperatura wewnętrzna w °C (null = 72°C)
  isActive            Boolean           @default(true)
  createdAt           DateTime          @default(now())
  updatedAt           DateTime          @updatedAt
  productionBatches   ProductionBatch[]
}

model ProductionBatch {
  id                   Int             @id @default(autoincrement())
  batchNumber          String          @unique
  productId            Int
  quantity             Float
  unit                 String
  productionDate       DateTime        @default(now())
  expiryDate           DateTime
  status               String          @default("IN_PRODUCTION")
  notes                String?
  userId               Int
  startTime            DateTime?
  endTime              DateTime?
  finalTemperature     Float?
  temperatureCompliant Boolean?
  createdAt            DateTime        @default(now())
  updatedAt            DateTime        @updatedAt
  materials            BatchMaterial[]
  product              Product         @relation(fields: [productId], references: [id])
  user                 User            @relation(fields: [userId], references: [id])
}

model BatchMaterial {
  id                Int                   @id @default(autoincrement())
  batchId           Int
  rawMaterialId     Int?
  receptionId       Int?
  curingBatchId     Int?
  materialId        Int?                  // Materiał (przyprawy, osłonki, konserwanty)
  materialReceiptId Int?                  // Przyjęcie materiału
  quantity          Float
  unit              String
  createdAt         DateTime              @default(now())
  batch             ProductionBatch       @relation(fields: [batchId], references: [id])
  curingBatch       CuringBatch?          @relation(fields: [curingBatchId], references: [id])
  material          Material?             @relation(fields: [materialId], references: [id])
  materialReceipt   MaterialReceipt?      @relation(fields: [materialReceiptId], references: [id])
  rawMaterial       RawMaterial?          @relation(fields: [rawMaterialId], references: [id])
  reception         RawMaterialReception? @relation(fields: [receptionId], references: [id])
}

model CleaningArea {
  id        Int              @id @default(autoincrement())
  name      String
  location  String
  frequency String
  method    String
  chemicals String?
  isActive  Boolean          @default(true)
  createdAt DateTime         @default(now())
  updatedAt DateTime         @updatedAt
  records   CleaningRecord[]
}

model CleaningRecord {
  id             Int          @id @default(autoincrement())
  cleaningAreaId Int
  cleanedAt      DateTime     @default(now())
  method         String
  chemicals      String?
  isVerified     Boolean      @default(false)
  notes          String?
  userId         Int
  createdAt      DateTime     @default(now())
  cleaningArea   CleaningArea @relation(fields: [cleaningAreaId], references: [id])
  user           User         @relation(fields: [userId], references: [id])
}

model PestControlPoint {
  id        Int                @id @default(autoincrement())
  name      String
  location  String
  type      String
  isActive  Boolean            @default(true)
  createdAt DateTime           @default(now())
  updatedAt DateTime           @updatedAt
  checks    PestControlCheck[]
}

model PestControlCheck {
  id                 Int              @id @default(autoincrement())
  pestControlPointId Int
  checkedAt          DateTime         @default(now())
  status             String
  findings           String?
  actionTaken        String?
  userId             Int
  createdAt          DateTime         @default(now())
  pestControlPoint   PestControlPoint @relation(fields: [pestControlPointId], references: [id])
  user               User             @relation(fields: [userId], references: [id])
}

model TrainingRecord {
  id           Int                   @id @default(autoincrement())
  title        String
  type         String
  description  String?
  trainer      String
  trainingDate DateTime
  validUntil   DateTime?
  createdAt    DateTime              @default(now())
  updatedAt    DateTime              @updatedAt
  participants TrainingParticipant[]
}

model TrainingParticipant {
  id         Int            @id @default(autoincrement())
  trainingId Int
  userId     Int
  passed     Boolean        @default(true)
  notes      String?
  createdAt  DateTime       @default(now())
  training   TrainingRecord @relation(fields: [trainingId], references: [id])
  user       User           @relation(fields: [userId], references: [id])
}

model CorrectiveAction {
  id           Int       @id @default(autoincrement())
  title        String
  description  String
  cause        String?
  actionTaken  String?
  status       String    @default("OPEN")
  priority     String    @default("MEDIUM")
  dueDate      DateTime?
  completedAt  DateTime?
  relatedCcpId Int?
  userId       Int
  createdAt    DateTime  @default(now())
  updatedAt    DateTime  @updatedAt
  user         User      @relation(fields: [userId], references: [id])
}

model AuditChecklist {
  id        Int           @id @default(autoincrement())
  name      String
  category  String
  items     String
  isActive  Boolean       @default(true)
  createdAt DateTime      @default(now())
  updatedAt DateTime      @updatedAt
  audits    AuditRecord[]
}

model AuditRecord {
  id              Int            @id @default(autoincrement())
  checklistId     Int
  auditDate       DateTime       @default(now())
  auditor         String
  results         String
  score           Float?
  findings        String?
  recommendations String?
  userId          Int
  createdAt       DateTime       @default(now())
  updatedAt       DateTime       @updatedAt
  checklist       AuditChecklist @relation(fields: [checklistId], references: [id])
  user            User           @relation(fields: [userId], references: [id])
}

model Document {
  id         Int       @id @default(autoincrement())
  title      String
  category   String
  fileName   String
  filePath   String
  version    String    @default("1.0")
  validFrom  DateTime  @default(now())
  validUntil DateTime?
  uploadedBy Int
  createdAt  DateTime  @default(now())
  updatedAt  DateTime  @updatedAt
  user       User      @relation(fields: [uploadedBy], references: [id])
}

model Material {
  id                Int               @id @default(autoincrement())
  name              String
  category          String
  unit              String
  supplierId        Int?
  minStock          Float?
  currentStock      Float             @default(0)
  storageConditions String?
  allergens         String?
  isActive          Boolean           @default(true)
  createdAt         DateTime          @default(now())
  updatedAt         DateTime          @updatedAt
  supplier          Supplier?         @relation(fields: [supplierId], references: [id])
  receipts          MaterialReceipt[]
  batchMaterials    BatchMaterial[]
}

model MaterialReceipt {
  id             Int             @id @default(autoincrement())
  materialId     Int
  supplierId     Int?
  batchNumber    String
  quantity       Float
  unit           String
  expiryDate     DateTime?
  pricePerUnit   Float?
  documentNumber String?
  receivedAt     DateTime        @default(now())
  notes          String?
  createdAt      DateTime        @default(now())
  material       Material        @relation(fields: [materialId], references: [id])
  supplier       Supplier?       @relation(fields: [supplierId], references: [id])
  batchMaterials BatchMaterial[]
}

model Butchering {
  id             Int                 @id @default(autoincrement())
  receptionId    Int
  batchNumber    String
  butcheringDate DateTime            @default(now())
  notes          String?
  createdAt      DateTime            @default(now())
  updatedAt      DateTime            @updatedAt
  elements       ButcheringElement[]
}

model ButcheringElement {
  id           Int        @id @default(autoincrement())
  butcheringId Int
  elementName  String
  quantity     Float
  destination  String?
  notes        String?
  createdAt    DateTime   @default(now())
  butchering   Butchering @relation(fields: [butcheringId], references: [id], onDelete: Cascade)
}

model playing_with_neon {
  id    Int    @id @default(autoincrement())
  name  String
  value Float? @db.Real
}
